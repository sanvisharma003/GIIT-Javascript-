MAIN FILE

const expectChai=require('chai').expect
const BlueSpice=require('./pageObjs/BlueSpice')
describe("Demo test",function()
{
    before(async ()=>
    {
        browser.url('http://localhost/blue2/mediawiki/index.php')
        browser.maximizeWindow();
        await BlueSpice.cookie.waitForDisplayed();
        await BlueSpice.Accept.click()
    });

    afterEach(()=>
    {
        browser.refresh();
    });
    it('login',async()=>{
        await BlueSpice.Login("Vrinda","HelloWorld123")
        await expect(BlueSpice.notification).toBeDisplayed()
    });

    it('File Upload',async()=>{
        
        const filePath = '/home/vrinda/Downloads/1722315414543.jpg'
        await BlueSpice.OpenFileList()
        await BlueSpice.UploadClick(filePath);
        await browser.pause(1000)
        await $('.oo-ui-iconElement-icon.oo-ui-icon-close').click();
    })

    it("File delete",async()=>
        {
        await BlueSpice.OpenFileList();
        await BlueSpice.deleteFile();
        
    })
})

PAGE OBJECT MODEL

const expectChai=require('chai').expect
class BlueSpice 
{
    get username()
    {
        return $('#wpName1');
    }
    get password()
    {
        return $('#wpPassword1')
    }
    get cookie()
    {
        return $('.bs-privacy-cookie-consent-mw-provider-bar')
    }
    get Accept()
    {
        return $('.bs-privacy-cookie-consent-mw-provider-bar span.oo-ui-buttonElement-framed a.oo-ui-buttonElement-button')
    }
    get logIn()
    {
        return $('#wpLoginAttempt')
    }
    get globalAction()
    {
        return $('#ga-btn')
    }
    get filelist()
    {
        return $('#ga-enhanced-standard-uis-filelist')
    }
    get notification()
    {
        return $('.mw-notification-content')
    }
    get uploadBtn()
    {
        return $("span a[href='/blue2/mediawiki/index.php/Special:Upload']");
    }
    get fileInput()
    {
        return $('a input.oo-ui-inputWidget-input');
    }
    async Login(username,password)
    {
        await $('#usr-login').click()
        await this.username.setValue(username);
        await this.password.setValue(password);
        await this.logIn.click()
    }
    async OpenFileList()
    {
        await this.globalAction.waitForDisplayed()
        await this.globalAction.click()

        await this.filelist.waitForDisplayed()
        await this.filelist.click()

        await expect(browser).toHaveTitle("File list - BlueSpice");
    }
    async UploadClick(filePath)
    {
        await this.uploadBtn.click()
        await expect(browser).toHaveTitle("Upload - BlueSpice");

        const remoteFilePath = await browser.uploadFile(filePath)
        await this.fileInput.setValue(remoteFilePath)
        browser.pause(2000)
        await $('.buttonField.oo-ui-layout.oo-ui-horizontalLayout').scrollIntoView()

        await $('.oo-ui-flaggedElement-progressive a.oo-ui-buttonElement-button').click()

        await expect($("#ooui-7")).toHaveText('Upload complete')
    }
    async deleteFile()
    {
        await $('.oojsplus-data-gridWidget-table').waitForDisplayed()

        const row = await $$('table tr');
        const lenBefore=row.length;
        console.log(lenBefore)

        await $('tbody tr:nth-child(1) td:last-child a.oo-ui-buttonElement-button').moveTo()
        await browser.pause(2000)
        await $('tbody tr:nth-child(1) td:last-child a.oo-ui-buttonElement-button').click()
        await browser.pause(2000)

        await $('.oo-ui-window-content-ready').waitForExist()
        await $('#standarddialogs-dlg-delete-btn-done a.oo-ui-buttonElement-button').click()

        await browser.waitUntil(async () => {
            const isPopupDisplayed = await $('.oo-ui-window-content-ready').isDisplayed();
            return !isPopupDisplayed;
        }, {
            timeout: 5000, // Timeout after 5 seconds
            timeoutMsg: 'Expected pop-up to be closed within 5 seconds'
        });

        await browser.pause(2000)
        
        const rowsAfterDeletion = await $$('table tr');
        const lenAfter = rowsAfterDeletion.length;
        console.log(lenAfter)
        
        expectChai(lenAfter).to.be.equal(lenBefore - 1);
        await browser.pause(3000)
    }
}
// new className
module.exports=new BlueSpice();

